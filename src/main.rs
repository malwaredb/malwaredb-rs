mod cli;

use malwaredb_server::init_tracing;

use std::process::ExitCode;

use clap::{CommandFactory, Parser};

/// MDB version
pub const MDB_VERSION: &str = env!("CARGO_PKG_VERSION");

#[tokio::main]
async fn main() -> anyhow::Result<ExitCode> {
    init_tracing();

    let app = cli::Options::parse();

    if let Some(generator) = app.generator {
        let mut cmd = cli::Options::command();
        eprintln!("Generating completion file for {generator:?}...");
        cli::print_completions(generator, &mut cmd);
        return Ok(ExitCode::SUCCESS);
    }

    app.execute().await
}
